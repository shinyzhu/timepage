<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TimePage</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#0f0f0f;
    --col-bg:#1a1a1a;
    --col-hover:#222;
    --text:#e0e0e0;
    --text-dim:#777;
    --accent:#4fc3f7;
    --border:#2a2a2a;
  }
  html,body{height:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);overflow:hidden}

  /* --- Zone Columns --- */
  #zones{display:flex;height:100vh;width:100%}
  .zone{
    flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
    border-right:1px solid var(--border);position:relative;transition:background .2s;
    min-width:0;
  }
  .zone:last-child{border-right:none}
  .zone:hover{background:var(--col-hover)}
  .zone .city{font-size:clamp(.75rem,1.6vw,1.1rem);text-transform:uppercase;letter-spacing:.12em;color:var(--text-dim);margin-bottom:.6rem}
  .zone .time{font-size:clamp(1.8rem,5vw,4rem);font-weight:200;letter-spacing:.04em;font-variant-numeric:tabular-nums}
  .zone .seconds{font-size:clamp(.7rem,1.4vw,.95rem);color:var(--text-dim);margin-top:.2rem;font-variant-numeric:tabular-nums}
  .zone .date{font-size:clamp(.6rem,1.1vw,.8rem);color:var(--text-dim);margin-top:.8rem;letter-spacing:.05em}
  .zone .offset{font-size:clamp(.55rem,1vw,.75rem);color:var(--accent);margin-top:.3rem;opacity:.7}
  .zone .remove-btn{
    position:absolute;top:8px;right:10px;background:none;border:none;color:var(--text-dim);
    cursor:pointer;font-size:1rem;opacity:0;transition:opacity .2s;line-height:1;
  }
  .zone:hover .remove-btn{opacity:1}
  .zone .remove-btn:hover{color:#e57373}

  /* Day/night subtle indicator */
  .zone.night{background:linear-gradient(180deg,#0d1117 0%,#161b22 100%)}
  .zone.day{background:linear-gradient(180deg,#1c2333 0%,#1a1a2e 100%)}

  /* --- Add Buttons (edge gutters) --- */
  .add-zone{
    display:flex;align-items:center;justify-content:center;flex-direction:column;gap:.3rem;
    min-width:28px;width:28px;cursor:pointer;border:none;background:transparent;
    color:var(--text-dim);font-size:1.3rem;transition:all .25s ease;flex-shrink:0;
    opacity:.25;position:relative;overflow:hidden;
  }
  .add-zone .add-label{
    font-size:.6rem;letter-spacing:.08em;text-transform:uppercase;writing-mode:vertical-rl;
    text-orientation:mixed;opacity:0;transition:opacity .25s;
  }
  .add-zone:hover{
    width:54px;min-width:54px;opacity:1;background:var(--col-hover);color:var(--accent);
  }
  .add-zone:hover .add-label{opacity:1}
  .add-zone.left{border-right:1px solid var(--border)}
  .add-zone.right{border-left:1px solid var(--border)}

  /* --- Modal --- */
  .modal-overlay{
    position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;
    justify-content:center;z-index:100;backdrop-filter:blur(4px);
  }
  .modal-overlay.open{display:flex}
  .modal{
    background:#1e1e1e;border:1px solid var(--border);border-radius:10px;padding:1.5rem;
    width:340px;max-height:70vh;display:flex;flex-direction:column;
  }
  .modal h2{font-size:.95rem;font-weight:500;margin-bottom:.8rem;color:var(--text-dim);letter-spacing:.05em}
  .modal input{
    width:100%;padding:.55rem .75rem;background:#2a2a2a;border:1px solid #3a3a3a;
    border-radius:6px;color:var(--text);font-size:.85rem;outline:none;margin-bottom:.6rem;
  }
  .modal input:focus{border-color:var(--accent)}
  .modal .tz-list{overflow-y:auto;flex:1;margin:0;padding:0;list-style:none}
  .modal .tz-list li{
    padding:.5rem .65rem;cursor:pointer;border-radius:5px;font-size:.82rem;
    display:flex;justify-content:space-between;color:var(--text);
  }
  .modal .tz-list li:hover{background:#2a2a2a}
  .modal .tz-list li .tz-offset{color:var(--text-dim);font-size:.75rem}
  .modal .close-btn{
    position:absolute;top:.5rem;right:.75rem;background:none;border:none;
    color:var(--text-dim);cursor:pointer;font-size:1.1rem;
  }

  /* --- Empty state --- */
  #empty{
    display:none;flex:1;align-items:center;justify-content:center;flex-direction:column;
    color:var(--text-dim);gap:.5rem;
  }
  #empty.show{display:flex}
  #empty span{font-size:.9rem}

  /* --- Mobile: vertical list --- */
  @media(max-width:600px){
    html,body{overflow:auto}
    #zones{flex-direction:column;height:auto;min-height:100vh;width:100%}
    .zone{
      flex:none;height:auto;min-height:0;padding:1.2rem .5rem;
      border-right:none;border-bottom:1px solid var(--border);
      flex-direction:row;flex-wrap:wrap;justify-content:space-between;gap:.1rem .8rem;
    }
    .zone:last-child{border-bottom:none}
    .zone .city{margin-bottom:0;font-size:.75rem;width:100%;text-align:left}
    .zone .time{font-size:1.8rem;order:1}
    .zone .seconds{font-size:.8rem;order:2;margin-top:.35rem}
    .zone .date{margin-top:0;order:3;font-size:.7rem}
    .zone .offset{margin-top:0;order:4;font-size:.65rem}
    .zone .remove-btn{opacity:.5;top:auto;bottom:8px;right:8px;font-size:.9rem}
    .zone.day,.zone.night{background:none}

    .add-zone{
      width:100%;min-width:unset;height:44px;flex-direction:row;opacity:.5;
      border:none!important;border-top:1px dashed var(--border)!important;
    }
    .add-zone .add-label{writing-mode:horizontal-tb;font-size:.65rem;opacity:1}
    .add-zone:hover{width:100%;min-width:unset;height:44px}
    .add-zone.left{border-top:none!important;border-bottom:1px dashed var(--border)!important}
  }
</style>
</head>
<body>

<div id="zones">
  <button class="add-zone left" title="Add time zone">+<span class="add-label">Add Zone</span></button>
  <div id="empty"><span>Click + to add a time zone</span></div>
  <button class="add-zone right" title="Add time zone">+<span class="add-label">Add Zone</span></button>
</div>

<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2>Add Time Zone</h2>
    <input id="tz-search" type="text" placeholder="Search city or zone…" autocomplete="off" autofocus>
    <ul class="tz-list" id="tz-list"></ul>
  </div>
</div>

<script>
(() => {
  // ---- Data ----
  const POPULAR = [
    // Americas
    {zone:'Pacific/Honolulu',label:'Honolulu'},
    {zone:'America/Anchorage',label:'Anchorage'},
    {zone:'America/Los_Angeles',label:'Los Angeles'},
    {zone:'America/Vancouver',label:'Vancouver'},
    {zone:'America/Denver',label:'Denver'},
    {zone:'America/Phoenix',label:'Phoenix'},
    {zone:'America/Chicago',label:'Chicago'},
    {zone:'America/Mexico_City',label:'Mexico City'},
    {zone:'America/New_York',label:'New York'},
    {zone:'America/Toronto',label:'Toronto'},
    {zone:'America/Bogota',label:'Bogotá'},
    {zone:'America/Lima',label:'Lima'},
    {zone:'America/Santiago',label:'Santiago'},
    {zone:'America/Sao_Paulo',label:'São Paulo'},
    {zone:'America/Buenos_Aires',label:'Buenos Aires'},
    // Europe
    {zone:'Atlantic/Reykjavik',label:'Reykjavik'},
    {zone:'Europe/London',label:'London'},
    {zone:'Europe/Dublin',label:'Dublin'},
    {zone:'Europe/Lisbon',label:'Lisbon'},
    {zone:'Europe/Paris',label:'Paris'},
    {zone:'Europe/Amsterdam',label:'Amsterdam'},
    {zone:'Europe/Brussels',label:'Brussels'},
    {zone:'Europe/Berlin',label:'Berlin'},
    {zone:'Europe/Zurich',label:'Zurich'},
    {zone:'Europe/Madrid',label:'Madrid'},
    {zone:'Europe/Rome',label:'Rome'},
    {zone:'Europe/Vienna',label:'Vienna'},
    {zone:'Europe/Prague',label:'Prague'},
    {zone:'Europe/Warsaw',label:'Warsaw'},
    {zone:'Europe/Stockholm',label:'Stockholm'},
    {zone:'Europe/Oslo',label:'Oslo'},
    {zone:'Europe/Copenhagen',label:'Copenhagen'},
    {zone:'Europe/Helsinki',label:'Helsinki'},
    {zone:'Europe/Athens',label:'Athens'},
    {zone:'Europe/Bucharest',label:'Bucharest'},
    {zone:'Europe/Istanbul',label:'Istanbul'},
    {zone:'Europe/Moscow',label:'Moscow'},
    // Africa
    {zone:'Africa/Casablanca',label:'Casablanca'},
    {zone:'Africa/Lagos',label:'Lagos'},
    {zone:'Africa/Cairo',label:'Cairo'},
    {zone:'Africa/Nairobi',label:'Nairobi'},
    {zone:'Africa/Johannesburg',label:'Johannesburg'},
    // Middle East
    {zone:'Asia/Jerusalem',label:'Jerusalem'},
    {zone:'Asia/Riyadh',label:'Riyadh'},
    {zone:'Asia/Dubai',label:'Dubai'},
    {zone:'Asia/Tehran',label:'Tehran'},
    // South & Central Asia
    {zone:'Asia/Karachi',label:'Karachi'},
    {zone:'Asia/Kolkata',label:'Mumbai'},
    {zone:'Asia/Colombo',label:'Colombo'},
    {zone:'Asia/Dhaka',label:'Dhaka'},
    {zone:'Asia/Kathmandu',label:'Kathmandu'},
    // Southeast Asia
    {zone:'Asia/Bangkok',label:'Bangkok'},
    {zone:'Asia/Ho_Chi_Minh',label:'Ho Chi Minh'},
    {zone:'Asia/Jakarta',label:'Jakarta'},
    {zone:'Asia/Singapore',label:'Singapore'},
    {zone:'Asia/Kuala_Lumpur',label:'Kuala Lumpur'},
    {zone:'Asia/Manila',label:'Manila'},
    // East Asia
    {zone:'Asia/Shanghai',label:'Shanghai'},
    {zone:'Asia/Hong_Kong',label:'Hong Kong'},
    {zone:'Asia/Taipei',label:'Taipei'},
    {zone:'Asia/Seoul',label:'Seoul'},
    {zone:'Asia/Tokyo',label:'Tokyo'},
    // Oceania
    {zone:'Australia/Perth',label:'Perth'},
    {zone:'Australia/Adelaide',label:'Adelaide'},
    {zone:'Australia/Sydney',label:'Sydney'},
    {zone:'Australia/Melbourne',label:'Melbourne'},
    {zone:'Australia/Brisbane',label:'Brisbane'},
    {zone:'Pacific/Auckland',label:'Auckland'},
    {zone:'Pacific/Fiji',label:'Fiji'},
  ];

  // Common timezone abbreviations / codes → IANA zone mapping
  const TZ_ALIASES = {
    // North America
    'HST':'Pacific/Honolulu','HAST':'Pacific/Honolulu',
    'AKST':'America/Anchorage','AKDT':'America/Anchorage',
    'PST':'America/Los_Angeles','PDT':'America/Los_Angeles','PT':'America/Los_Angeles',
    'MST':'America/Denver','MDT':'America/Denver','MT':'America/Denver',
    'CST':'America/Chicago','CDT':'America/Chicago','CT':'America/Chicago',
    'EST':'America/New_York','EDT':'America/New_York','ET':'America/New_York',
    'AST':'America/Halifax','ADT':'America/Halifax',
    'NST':'America/St_Johns','NDT':'America/St_Johns',
    // Europe
    'GMT':'Europe/London','BST':'Europe/London','UTC':'Etc/UTC',
    'WET':'Europe/Lisbon','WEST':'Europe/Lisbon',
    'CET':'Europe/Paris','CEST':'Europe/Paris',
    'EET':'Europe/Athens','EEST':'Europe/Athens',
    'MSK':'Europe/Moscow',
    // Asia
    'IST':'Asia/Kolkata','PKT':'Asia/Karachi',
    'NPT':'Asia/Kathmandu',
    'BST_BD':'Asia/Dhaka','BDT':'Asia/Dhaka',
    'ICT':'Asia/Bangkok',
    'WIB':'Asia/Jakarta','WITA':'Asia/Makassar','WIT':'Asia/Jayapura',
    'SGT':'Asia/Singapore','MYT':'Asia/Kuala_Lumpur',
    'PHT':'Asia/Manila','PHST':'Asia/Manila',
    'CST_CN':'Asia/Shanghai','HKT':'Asia/Hong_Kong',
    'KST':'Asia/Seoul',
    'JST':'Asia/Tokyo',
    // Middle East
    'IRST':'Asia/Tehran','GST':'Asia/Dubai',
    'AST_AR':'Asia/Riyadh',
    'IDT':'Asia/Jerusalem',
    // Africa
    'WAT':'Africa/Lagos','CAT':'Africa/Johannesburg','EAT':'Africa/Nairobi',
    'SAST':'Africa/Johannesburg',
    // Oceania
    'AWST':'Australia/Perth','ACST':'Australia/Adelaide','ACDT':'Australia/Adelaide',
    'AEST':'Australia/Sydney','AEDT':'Australia/Sydney',
    'NZST':'Pacific/Auckland','NZDT':'Pacific/Auckland',
  };

  // Build full list from Intl API with alias search tags
  let ALL_ZONES;
  try {
    ALL_ZONES = Intl.supportedValuesOf('timeZone').map(tz => {
      const label = tz.split('/').pop().replace(/_/g,' ');
      // Collect all abbreviation aliases that point to this zone
      const aliases = Object.entries(TZ_ALIASES)
        .filter(([,v]) => v === tz)
        .map(([k]) => k);
      return {zone:tz, label, aliases};
    });
  } catch {
    ALL_ZONES = POPULAR.map(p => ({...p, aliases:[]}));
  }

  const STORAGE_KEY = 'timepage_zones';
  const DEFAULT_ZONES = [
    {zone:'America/New_York',label:'New York'},
    {zone:'Europe/London',label:'London'},
    {zone:'Asia/Tokyo',label:'Tokyo'},
    {zone:'Australia/Sydney',label:'Sydney'},
  ];

  // ---- State ----
  let zones = loadZones();

  function loadZones() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) { const parsed = JSON.parse(raw); if (parsed.length) return parsed; }
    } catch {}
    return [...DEFAULT_ZONES];
  }
  function saveZones() { localStorage.setItem(STORAGE_KEY, JSON.stringify(zones)); }

  // ---- DOM refs ----
  const $zones = document.getElementById('zones');
  const $empty = document.getElementById('empty');
  const $modal = document.getElementById('modal');
  const $search = document.getElementById('tz-search');
  const $list = document.getElementById('tz-list');
  const $addLeft = $zones.querySelector('.add-zone.left');
  const $addRight = $zones.querySelector('.add-zone.right');

  // ---- Rendering ----
  function render() {
    $zones.querySelectorAll('.zone').forEach(el => el.remove());
    $empty.classList.toggle('show', zones.length === 0);

    zones.forEach((z, i) => {
      const col = document.createElement('div');
      col.className = 'zone';
      col.dataset.zone = z.zone;
      col.dataset.index = i;
      col.innerHTML = `
        <button class="remove-btn" title="Remove">&times;</button>
        <div class="city">${esc(z.label)}</div>
        <div class="time"></div>
        <div class="seconds"></div>
        <div class="date"></div>
        <div class="offset"></div>
      `;
      col.querySelector('.remove-btn').addEventListener('click', () => removeZone(i));

      // Drag support
      col.draggable = true;
      col.addEventListener('dragstart', onDragStart);
      col.addEventListener('dragover', onDragOver);
      col.addEventListener('drop', onDrop);
      col.addEventListener('dragend', onDragEnd);

      // Insert before the right add-button
      $zones.insertBefore(col, $addRight);
    });
    tick();
  }

  function tick() {
    const now = new Date();
    document.querySelectorAll('.zone').forEach(col => {
      const tz = col.dataset.zone;
      try {
        const timeFmt = new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'2-digit',minute:'2-digit',hour12:false});
        const secFmt  = new Intl.DateTimeFormat('en-US',{timeZone:tz,second:'2-digit'});
        const dateFmt = new Intl.DateTimeFormat('en-US',{timeZone:tz,weekday:'short',month:'short',day:'numeric'});
        const offFmt  = new Intl.DateTimeFormat('en-US',{timeZone:tz,timeZoneName:'shortOffset'});

        col.querySelector('.time').textContent = timeFmt.format(now);
        col.querySelector('.seconds').textContent = ':' + secFmt.format(now).padStart(2,'0');
        col.querySelector('.date').textContent = dateFmt.format(now);

        const offParts = offFmt.formatToParts(now);
        const offStr = offParts.find(p => p.type === 'timeZoneName')?.value || '';
        col.querySelector('.offset').textContent = offStr;

        // Day/night indicator (6-18 = day)
        const hourStr = new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'numeric',hour12:false}).format(now);
        const h = parseInt(hourStr, 10);
        col.classList.toggle('day', h >= 6 && h < 18);
        col.classList.toggle('night', h < 6 || h >= 18);
      } catch {}
    });
  }

  // ---- Zone management ----
  let insertPosition = 'end'; // 'start' or 'end'
  function addZone(zone, label) {
    if (zones.some(z => z.zone === zone)) return;
    if (insertPosition === 'start') {
      zones.unshift({zone, label});
    } else {
      zones.push({zone, label});
    }
    saveZones();
    render();
  }
  function removeZone(i) {
    zones.splice(i, 1);
    saveZones();
    render();
  }

  // ---- Drag & drop reorder ----
  let dragIdx = null;
  function onDragStart(e) {
    dragIdx = +this.dataset.index;
    this.style.opacity = '.4';
    e.dataTransfer.effectAllowed = 'move';
  }
  function onDragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }
  function onDrop(e) {
    e.preventDefault();
    const toIdx = +this.dataset.index;
    if (dragIdx !== null && dragIdx !== toIdx) {
      const [moved] = zones.splice(dragIdx, 1);
      zones.splice(toIdx, 0, moved);
      saveZones();
      render();
    }
  }
  function onDragEnd() { this.style.opacity = ''; dragIdx = null; }

  // ---- Modal ----
  function openModal(position) {
    insertPosition = position || 'end';
    $modal.classList.add('open');
    $search.value = '';
    populateList('');
    setTimeout(() => $search.focus(), 50);
  }
  function closeModal() { $modal.classList.remove('open'); }

  function populateList(query) {
    const q = query.toLowerCase().trim();

    // Check if query matches a TZ abbreviation exactly → show that zone first
    const aliasMatch = q ? Object.entries(TZ_ALIASES).find(([k]) => k.toLowerCase() === q) : null;

    let source, filtered;
    if (!q) {
      source = POPULAR;
      filtered = source;
    } else {
      // Search ALL_ZONES by label, full zone path, region, and aliases
      filtered = ALL_ZONES.filter(z => {
        const lbl = z.label.toLowerCase();
        const zn = z.zone.toLowerCase().replace(/_/g,' ');
        const region = z.zone.split('/')[0].toLowerCase();
        const aliasHit = z.aliases && z.aliases.some(a => a.toLowerCase().includes(q));
        return lbl.includes(q) || zn.includes(q) || region.includes(q) || aliasHit;
      });

      // Boost alias exact-match to top
      if (aliasMatch) {
        const matchZone = aliasMatch[1];
        filtered.sort((a, b) => (a.zone === matchZone ? -1 : b.zone === matchZone ? 1 : 0));
      }
    }

    filtered = filtered.slice(0, 50);

    $list.innerHTML = '';
    const now = new Date();
    filtered.forEach(z => {
      const li = document.createElement('li');
      let off = '';
      try {
        const parts = new Intl.DateTimeFormat('en-US',{timeZone:z.zone,timeZoneName:'shortOffset'}).formatToParts(now);
        off = parts.find(p => p.type === 'timeZoneName')?.value || '';
      } catch {}
      const aliasTag = z.aliases && z.aliases.length ? ` (${z.aliases.join(', ')})` : '';
      li.innerHTML = `<span>${esc(z.label)}${esc(aliasTag)}</span><span class="tz-offset">${esc(off)}</span>`;
      li.addEventListener('click', () => { addZone(z.zone, z.label); closeModal(); });
      $list.appendChild(li);
    });
  }

  $search.addEventListener('input', () => populateList($search.value));
  $addLeft.addEventListener('click', () => openModal('start'));
  $addRight.addEventListener('click', () => openModal('end'));
  $modal.addEventListener('click', e => { if(e.target === $modal) closeModal(); });
  document.addEventListener('keydown', e => { if(e.key === 'Escape') closeModal(); });

  // ---- Helpers ----
  function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  // ---- Init ----
  render();
  setInterval(tick, 1000);
})();
</script>
</body>
</html>
